<?xml version="1.0" encoding="UTF-8"?>
<mod>
    <require file="apply-action.xml"/>
    
    <action name="move">
        <object name="subject"/>
        <integer name="dx"/>
        <integer name="dy"/>
        
        <code>
# check if he can land there
tile = subject.getTile(dx, dy)
if not tile.get('ground').attr('standable'):
    raise RuntimeError('entity tries to step on non-standable')

try:
    subject.move(dx, dy)
except TileTakenError:
    warning('trying to step on taken tile')

# waste energy
subject.changeNumericAttr('hungry', 0.1)

# process traps
traps = tile.get('trap')
if traps:
    try:
        ti = iter(traps)
    except TypeError:
        traps = [traps]
    for trap in traps:
        # TODO: random
        action('apply', {'subject' : trap, 'target' : subject})
else:
    info('user was lucky enough to not step on the trap')
        </code>
    </action>
</mod>
